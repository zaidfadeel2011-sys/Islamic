// Service Worker للإشعارات الحقيقية
self.addEventListener('install', function(event) {
    event.waitUntil(self.skipWaiting());
});

self.addEventListener('activate', function(event) {
    event.waitUntil(self.clients.claim());
});

self.addEventListener('push', function(event) {
    if (!event.data) return;
    
    const data = event.data.json();
    const options = {
        body: data.body || 'تذكير بالأذكار',
        icon: data.icon || 'icons/icon-192x192.png',
        badge: 'icons/badge-72x72.png',
        tag: data.tag || 'islamic-app-push',
        requireInteraction: true,
        actions: [
            {action: 'open', title: 'فتح التطبيق'},
            {action: 'close', title: 'إغلاق'}
        ],
        vibrate: [200, 100, 200]
    };
    
    event.waitUntil(
        self.registration.showNotification(data.title || '⏰ وقت الأذكار', options)
    );
});

self.addEventListener('notificationclick', function(event) {
    event.notification.close();
    
    if (event.action === 'open') {
        event.waitUntil(
            clients.matchAll({type: 'window', includeUncontrolled: true})
                .then(function(clientList) {
                    if (clientList.length > 0) {
                        let client = clientList[0];
                        for (let i = 0; i < clientList.length; i++) {
                            if (clientList[i].focused) {
                                client = clientList[i];
                            }
                        }
                        return client.focus();
                    }
                    return clients.openWindow('/');
                })
        );
    }
});
